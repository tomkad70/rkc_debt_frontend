<template>
  <FormSection title="–°—É–¥–µ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è" icon="‚öñ">
    <!-- –ë–ª–æ–∫ "–ü–æ–¥–∞–ª–∏ –≤ —Å—É–¥" —Å –ø–æ–ª—è–º–∏ -->
    <FormItem label="–ü–æ–¥–∞–ª–∏ –≤ —Å—É–¥" isCheckbox>
      <template #checkbox>
        <input
            type="checkbox"
            v-model="isInCourt"
            class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50 mr-2 cursor-pointer"
        />
      </template>
    </FormItem>

    <!-- –ü–æ–ª—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Å—É–¥–æ–º, —Å –æ—Ç—Å—Ç—É–ø–æ–º –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ -->
    <div class="ml-6 mt-2" :class="{'opacity-50': !isInCourt}">
      <FormItem label="üìÇ –¢–µ–∫—É—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ">
        <select
            v-model="form.action_type"
            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 outline-none cursor-pointer"
            :disabled="!isInCourt"
        >
          <option value="">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
          <option value="–°—É–¥–µ–±–Ω—ã–π –ø—Ä–∏–∫–∞–∑">–°—É–¥–µ–±–Ω—ã–π –ø—Ä–∏–∫–∞–∑</option>
          <option value="–ò—Å–∫–æ–≤–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ">–ò—Å–∫–æ–≤–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</option>
        </select>
      </FormItem>

      <FormItem label="‚öñ ‚Ññ —Å—É–¥–µ–±–Ω–æ–≥–æ –¥–µ–ª–∞">

        <input
            v-model="form.court_case_number"
            type="text"
            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 outline-none"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Å—É–¥–µ–±–Ω–æ–≥–æ –¥–µ–ª–∞"
            :disabled="!isInCourt"
        />
      </FormItem>

      <FormItem label="üìÖ –î–∞—Ç–∞ —Å—É–¥–µ–±–Ω–æ–≥–æ –¥–µ–ª–∞">
        <input
            v-model="form.court_case_date"
            type="date"
            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 outline-none cursor-pointer"
            :disabled="!isInCourt"
        />
      </FormItem>

      <FormItem label="üìú –†–µ—à–µ–Ω–∏–µ —Å—É–¥–∞" fullWidth>
        <textarea
            v-model="form.court_decision"
            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 outline-none min-h-[80px]"
            placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ —Å—É–¥–∞..."
            :disabled="!isInCourt"
        ></textarea>
      </FormItem>

      <FormItem label="üìÖ –î–∞—Ç–∞ —Ä–µ—à–µ–Ω–∏—è —Å—É–¥–∞">
        <input
            v-model="form.court_decision_date"
            type="date"
            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 outline-none cursor-pointer"
            :disabled="!isInCourt"
        />
      </FormItem>

      <FormItem label="üìÖ –î–∞—Ç–∞ —Å—É–¥–µ–±–Ω–æ–≥–æ –ø—Ä–∏–∫–∞–∑–∞">
        <input
            v-model="form.court_order_date"
            type="date"
            class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 outline-none cursor-pointer"
            :disabled="!isInCourt"
        />
      </FormItem>
    </div>

    <!-- –ë–ª–æ–∫ –£–§–°–°–ü —Å –ø–æ–ª—è–º–∏ -->
    <div class="border-t border-gray-200 mt-4 pt-4">

      <FormItem label="–£–§–°–°–ü –ø–µ—Ä–µ–¥–∞–Ω–æ" isCheckbox>
        <template #checkbox>
          <input
              type="checkbox"
              v-model="isUfsspSent"
              class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50 mr-2 cursor-pointer"
          />
        </template>
      </FormItem>

      <!-- –ü–æ–ª—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –£–§–°–°–ü, —Å –æ—Ç—Å—Ç—É–ø–æ–º –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ -->
      <div class="ml-6 mt-2" :class="{'opacity-50': !isUfsspSent}">
        <FormItem label="üìë ‚Ññ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞">
          <input
              v-model="form.execution_number"
              type="text"
              class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 outline-none"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞"
              :disabled="!isUfsspSent"
          />
        </FormItem>

        <FormItem label="üìÖ –î–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞">

          <input
              v-model="form.execution_date"
              type="date"
              class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-blue-500 focus:border-blue-500 outline-none cursor-pointer"
              :disabled="!isUfsspSent"
          />
        </FormItem>
      </div>
    </div>
  </FormSection>
</template>

<script setup>
import {ref, computed, watch, onMounted} from 'vue'
import FormSection from '@/components/common/FormSection.vue'
import FormItem from '@/components/common/FormItem.vue'

const props = defineProps({
  form: {
    type: Object,
    required: true
  }
})

// –°–æ–∑–¥–∞–µ–º —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤
const isInCourt = ref(false)
const isUfsspSent = ref(false)

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Ñ–æ—Ä–º–æ–π
onMounted(() => {
  // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ —á–∏—Å–ª–∞/—Å—Ç—Ä–æ–∫–∏ –≤ boolean
  isInCourt.value = !!props.form.is_in_court
  isUfsspSent.value = !!props.form.ufssp_sent
})

// –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ —Ñ–æ—Ä–º–µ
watch(() => props.form, (newVal) => {
  if (newVal) {
    isInCourt.value = !!newVal.is_in_court
    isUfsspSent.value = !!newVal.ufssp_sent
  }
}, {deep: true})

// –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ —á–µ–∫–±–æ–∫—Å–∞—Ö –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
watch(isInCourt, (newVal) => {
  props.form.is_in_court = newVal ? 1 : 0
})

watch(isUfsspSent, (newVal) => {
  props.form.ufssp_sent = newVal ? 1 : 0
})
</script>